  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "items" does not exist
LINE 5:                WHERE a.attrelid = '"items"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"items"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "items" does not exist
LINE 5:                WHERE a.attrelid = '"items"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"items"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
PG::UndefinedTable: ERROR:  relation "items" does not exist
LINE 5:                WHERE a.attrelid = '"items"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"items"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "users" does not exist
LINE 5:                WHERE a.attrelid = '"users"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"users"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "items" does not exist
LINE 5:                WHERE a.attrelid = '"items"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"items"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
PG::UndefinedTable: ERROR:  relation "items" does not exist
LINE 5:                WHERE a.attrelid = '"items"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"items"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
PG::UndefinedTable: ERROR:  relation "items" does not exist
LINE 5:                WHERE a.attrelid = '"items"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"items"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (2.6ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.3ms)[0m  CREATE UNIQUE INDEX  "unique_schema_migrations" ON "schema_migrations"  ("version")
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to EnableExtensions (20140628203243)
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSQL (2.8ms)[0m  [1mCREATE EXTENSION IF NOT EXISTS "uuid-ossp"[0m
  [1m[35mSQL (16.7ms)[0m  CREATE EXTENSION IF NOT EXISTS "hstore"
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES ($1)[0m  [["version", "20140628203243"]]
  [1m[35m (2.8ms)[0m  COMMIT
Migrating to CreateUsers (20140628203244)
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (2.9ms)[0m  CREATE TABLE "users" ("id" uuid PRIMARY KEY  DEFAULT uuid_generate_v4(), "identifier" character varying(255), "properties" hstore, "created_at" timestamp, "updated_at" timestamp) 
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES ($1)[0m  [["version", "20140628203244"]]
  [1m[35m (0.5ms)[0m  COMMIT
Migrating to CreateItems (20140628203245)
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "items" ("id" uuid PRIMARY KEY  DEFAULT uuid_generate_v4(), "name" character varying(255), "properties" hstore, "created_at" timestamp, "updated_at" timestamp) 
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES ($1)[0m  [["version", "20140628203245"]]
  [1m[35m (0.8ms)[0m  COMMIT
Migrating to CreateEvents (20140628203246)
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (1.4ms)[0m  CREATE TABLE "events" ("id" uuid PRIMARY KEY  DEFAULT uuid_generate_v4(), "user_id" uuid, "item_id" uuid, "event" character varying(255), "created_at" timestamp, "updated_at" timestamp) 
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES ($1)[0m  [["version", "20140628203246"]]
  [1m[35m (0.4ms)[0m  COMMIT
Migrating to AddIdentifierToItem (20140628203247)
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.4ms)[0m  ALTER TABLE "items" ADD COLUMN "identifier" character varying(255)
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES ($1)[0m  [["version", "20140628203247"]]
  [1m[35m (0.4ms)[0m  COMMIT
Migrating to AddIndexesToUserAndItem (20140628203248)
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.7ms)[0m  CREATE  INDEX  "index_items_on_identifier" ON "items"  ("identifier")
  [1m[36m (0.7ms)[0m  [1mCREATE  INDEX  "index_users_on_identifier" ON "users"  ("identifier")[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES ($1)  [["version", "20140628203248"]]
  [1m[36m (0.4ms)[0m  [1mCOMMIT[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (2.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:41:35.577518"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.577518"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:41:35.590023"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:41:35.590023"]]
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.4ms | ActiveRecord: 1.3ms)
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.4ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:41:35.596276"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.596276"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:41:35.600640"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:41:35.600640"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:41:35.604396"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.604396"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"56f265f7-6545-4fb3-8252-e393f109a414", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.4ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "56f265f7-6545-4fb3-8252-e393f109a414"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.3ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '56f265f7-6545-4fb3-8252-e393f109a414') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '56f265f7-6545-4fb3-8252-e393f109a414'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 11:41:35.610233"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 5ms (Views: 0.3ms | ActiveRecord: 1.0ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.4ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.623670"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.623670"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.626521"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.626521"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.633092"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.633092"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.635393"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.635393"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.639623"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.639623"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.641785"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.641785"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.645512"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.645512"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.647551"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.647551"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.653233"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.653233"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.657727"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.657727"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.661375"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.661375"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.665037"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.665037"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.674709"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.674709"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------
LayerApiTest: test_truth
------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.684568"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.684568"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:41:35.686923"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:41:35.686923"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.743265"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.743265"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.753153"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:43:37.753153"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.3ms | ActiveRecord: 1.3ms)
  [1m[35m (3.3ms)[0m  ROLLBACK
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.763800"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.763800"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.768256"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:43:37.768256"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.772081"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.772081"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"9d92ed46-e13e-49f9-b5cf-ce342bb9cf16", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.3ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "9d92ed46-e13e-49f9-b5cf-ce342bb9cf16"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.3ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '9d92ed46-e13e-49f9-b5cf-ce342bb9cf16') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '9d92ed46-e13e-49f9-b5cf-ce342bb9cf16'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 11:43:37.777442"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 5ms (Views: 0.3ms | ActiveRecord: 0.9ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:43:37.790320"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.790320"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:43:37.793052"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.793052"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 61ms (Views: 0.2ms | ActiveRecord: 1.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:43:37.862747"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.862747"]]
  [1m[35m (0.3ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:43:37.865736"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.865736"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.5ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.873448"], ["event", "view"], ["item_id", "1ea4c923-c50a-4f3c-8616-ee9d4826d7f6"], ["updated_at", "2014-06-29 11:43:37.873448"], ["user_id", "d22c07cb-03c1-4b2a-84c3-a678c6ae6f87"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.3ms | ActiveRecord: 1.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.3ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.878846"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.878846"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.881709"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.881709"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[35mUser Load (0.3ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.888344"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 11:43:37.888344"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:43:37.890297"], ["event", "view"], ["item_id", "eb6429e8-4cff-4180-84a3-8b0312709949"], ["updated_at", "2014-06-29 11:43:37.890297"], ["user_id", "73e84061-6d48-4dc1-be7e-c405e5cae314"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 7ms (Views: 0.3ms | ActiveRecord: 2.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.4ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:43:37.895516"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.895516"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.5ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:43:37.898488"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.898488"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.904014"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 11:43:37.904014"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mItem Load (0.3ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.907077"], ["event", "view"], ["item_id", "33ca3766-4f55-455d-9062-19f25ce871a4"], ["updated_at", "2014-06-29 11:43:37.907077"], ["user_id", "8976914e-d619-4da8-9700-1072ed090e91"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.3ms | ActiveRecord: 1.9ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.914804"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.914804"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.919437"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:43:37.919437"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.923008"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.923008"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.926864"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:43:37.926864"]]
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 1.1ms)
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.931421"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.931421"]]
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:43:37.939407"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.939407"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"86c211a2-34c8-43bb-80f1-abd4fbe821bb", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "86c211a2-34c8-43bb-80f1-abd4fbe821bb"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '86c211a2-34c8-43bb-80f1-abd4fbe821bb') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:43:37.947332"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.947332"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"ad8611c4-353d-4a05-ba72-0a831aa0673a", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "ad8611c4-353d-4a05-ba72-0a831aa0673a"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != 'ad8611c4-353d-4a05-ba72-0a831aa0673a') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = 'ad8611c4-353d-4a05-ba72-0a831aa0673a'  [["properties", nil], ["updated_at", "2014-06-29 11:43:37.951625"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.956895"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.956895"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:43:37.959103"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:43:37.959103"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.2ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.9ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.694853"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.694853"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.703756"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:44:39.703756"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.707751"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.707751"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.711677"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:44:39.711677"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.715355"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.715355"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 13ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:44:39.732531"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.732531"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"22537d88-0901-497e-b111-df5c6ad5e5f3", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "22537d88-0901-497e-b111-df5c6ad5e5f3"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '22537d88-0901-497e-b111-df5c6ad5e5f3') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:44:39.740525"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.740525"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"5e9775ff-5c68-4274-8146-e392db791d54", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "5e9775ff-5c68-4274-8146-e392db791d54"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '5e9775ff-5c68-4274-8146-e392db791d54') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '5e9775ff-5c68-4274-8146-e392db791d54'  [["properties", nil], ["updated_at", "2014-06-29 11:44:39.744617"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.752358"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.752358"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.761135"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.761135"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (1.8ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.3ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:44:39.816069"], ["event", "view"], ["item_id", "3a7b521b-cbf3-4770-91fe-a1a30105fe36"], ["updated_at", "2014-06-29 11:44:39.816069"], ["user_id", "2ae882f2-9192-4a96-9deb-38d75d950e4e"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 53ms (Views: 0.3ms | ActiveRecord: 4.0ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:44:39.820386"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.820386"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:44:39.822386"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.822386"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 11:44:39.827708"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 11:44:39.827708"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.829471"], ["event", "view"], ["item_id", "f9e8d452-c496-44f2-aa6d-2ad6dd94ebac"], ["updated_at", "2014-06-29 11:44:39.829471"], ["user_id", "5d8e8086-86a5-4673-99b9-52b00bf879da"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.833191"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.833191"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.835345"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.835345"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 11:44:39.839940"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 11:44:39.839940"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:44:39.842468"], ["event", "view"], ["item_id", "a926dcc9-a08b-4111-99f3-24495104243b"], ["updated_at", "2014-06-29 11:44:39.842468"], ["user_id", "25848cae-1a18-498d-a655-de04ccae6211"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 1.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:44:39.847889"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.847889"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:44:39.849977"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.849977"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#index as JSON
  [1m[36mEvent Load (0.2ms)[0m  [1mSELECT "events".* FROM "events"[0m
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.867238"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.867238"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.869400"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.869400"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 3ms (Views: 0.2ms | ActiveRecord: 0.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.879991"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.879991"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.884485"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:44:39.884485"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.887917"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.887917"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.891622"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:44:39.891622"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:44:39.895133"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:44:39.895133"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"a6241473-0a0f-4b73-b0d6-820b554afd15", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "a6241473-0a0f-4b73-b0d6-820b554afd15"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != 'a6241473-0a0f-4b73-b0d6-820b554afd15') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = 'a6241473-0a0f-4b73-b0d6-820b554afd15'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 11:44:39.899526"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.8ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.7ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.9ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:46:57.188622"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.188622"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:46:57.199888"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.199888"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.7ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.228136"], ["event", "view"], ["item_id", "4ca73b5e-b71f-4d8e-a7d8-9e7e37d6d6f3"], ["updated_at", "2014-06-29 11:46:57.228136"], ["user_id", "f6a41950-8a85-4b88-b9e2-a553526d0a4f"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 26ms (Views: 0.3ms | ActiveRecord: 2.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.232912"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.232912"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.235045"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.235045"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.240076"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 11:46:57.240076"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:46:57.241682"], ["event", "view"], ["item_id", "2bf618fc-0bf5-4581-9681-6e1d7c87e823"], ["updated_at", "2014-06-29 11:46:57.241682"], ["user_id", "929d0455-6a57-4798-8f00-10e5bcd09b0c"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:46:57.245419"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.245419"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:46:57.247381"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.247381"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.251654"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 11:46:57.251654"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.253912"], ["event", "view"], ["item_id", "d797127e-55cd-4e03-a872-f5d07a22b1fc"], ["updated_at", "2014-06-29 11:46:57.253912"], ["user_id", "b81a178f-bc97-44fc-90ba-ba05cd5e55b8"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 5ms (Views: 0.2ms | ActiveRecord: 1.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.259144"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.259144"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.263636"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:46:57.263636"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.267124"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.267124"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.270656"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:46:57.270656"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.274208"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.274208"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"7c314c63-6244-4373-a169-c695b4bf7cf6", "item"=>{"name"=>"item 2"}}
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1[0m  [["id", "7c314c63-6244-4373-a169-c695b4bf7cf6"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '7c314c63-6244-4373-a169-c695b4bf7cf6') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '7c314c63-6244-4373-a169-c695b4bf7cf6'  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 11:46:57.278880"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:46:57.285492"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.285492"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:46:57.289929"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:46:57.289929"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:46:57.293261"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.293261"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:46:57.296702"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:46:57.296702"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:46:57.299801"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.299801"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 39ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.343033"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.343033"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"de22b4f9-86ba-483e-9aea-9393883a4680", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "de22b4f9-86ba-483e-9aea-9393883a4680"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != 'de22b4f9-86ba-483e-9aea-9393883a4680') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.350118"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.350118"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"14de7913-1605-4683-b28e-260938f8eed3", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "14de7913-1605-4683-b28e-260938f8eed3"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '14de7913-1605-4683-b28e-260938f8eed3') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '14de7913-1605-4683-b28e-260938f8eed3'  [["properties", nil], ["updated_at", "2014-06-29 11:46:57.353794"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:46:57.369599"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.369599"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:46:57.371731"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.371731"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.2ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.378441"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.378441"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:46:57.380485"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:46:57.380485"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.7ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:21.049163"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.049163"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:21.057756"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:52:21.057756"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:21.061794"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.061794"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:21.065472"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:52:21.065472"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:21.068738"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.068738"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 13ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:21.085752"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.085752"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"e22dce97-d824-41cf-909d-96899e7d21c2", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "e22dce97-d824-41cf-909d-96899e7d21c2"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != 'e22dce97-d824-41cf-909d-96899e7d21c2') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:21.093844"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.093844"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"11152dc9-ddf7-450f-a46a-39aa60f67d7b", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "11152dc9-ddf7-450f-a46a-39aa60f67d7b"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '11152dc9-ddf7-450f-a46a-39aa60f67d7b') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '11152dc9-ddf7-450f-a46a-39aa60f67d7b'  [["properties", nil], ["updated_at", "2014-06-29 11:52:21.097873"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:21.104165"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.104165"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:21.112840"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.112840"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 45ms (Views: 0.2ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:21.165944"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.165944"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:21.168170"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.168170"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.5ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:21.175517"], ["event", "view"], ["item_id", "13cdc0d8-ef56-4553-80ad-f6b30ddbf0de"], ["updated_at", "2014-06-29 11:52:21.175517"], ["user_id", "15eeeeef-c07c-4ba1-a6b8-72221bc2cadc"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 1.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:21.179490"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.179490"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.1ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:21.181442"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.181442"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:21.186229"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 11:52:21.186229"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:21.187934"], ["event", "view"], ["item_id", "5bbe3c91-0572-4412-ab52-6b839672f884"], ["updated_at", "2014-06-29 11:52:21.187934"], ["user_id", "3fbc33e7-3ad0-4660-a7bf-b1b036e3108f"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:21.191270"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.191270"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:21.193210"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.193210"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:21.197444"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 11:52:21.197444"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:21.199660"], ["event", "view"], ["item_id", "78f65bff-667a-4cee-b1a1-448583ecd5d2"], ["updated_at", "2014-06-29 11:52:21.199660"], ["user_id", "48c13e13-1204-442d-b031-bddac541951e"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 5ms (Views: 0.2ms | ActiveRecord: 1.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:21.205215"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.205215"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:21.210146"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:52:21.210146"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:21.213716"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.213716"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:21.217133"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:52:21.217133"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:21.220300"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.220300"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"5f1d9470-ba54-470c-80a9-2e9208fe5072", "item"=>{"name"=>"item 2"}}
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1[0m  [["id", "5f1d9470-ba54-470c-80a9-2e9208fe5072"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '5f1d9470-ba54-470c-80a9-2e9208fe5072') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '5f1d9470-ba54-470c-80a9-2e9208fe5072'  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 11:52:21.224237"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:21.230596"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.230596"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:21.232692"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:21.232692"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.2ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------
LayerApiTest: test_truth
------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.7ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.9ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.640553"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.640553"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.651525"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.651525"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.4ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.4ms)
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:54.665778"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.665778"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:54.668045"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.668045"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.6ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.690255"], ["event", "view"], ["item_id", "a852de44-fd14-4099-828b-c584c49c9a40"], ["updated_at", "2014-06-29 11:52:54.690255"], ["user_id", "8c89efe4-f530-4efd-b8f3-39a434dfaa14"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.3ms | ActiveRecord: 2.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.694879"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.694879"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.697179"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.697179"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[35mUser Load (0.3ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.702613"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 11:52:54.702613"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:54.704221"], ["event", "view"], ["item_id", "af246d84-3be4-44bd-90cd-b3576d4a0996"], ["updated_at", "2014-06-29 11:52:54.704221"], ["user_id", "dd0b8d35-fc52-4f2d-a28f-e94fc6d1c7b8"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:54.707866"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.707866"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.1ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:54.709854"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.709854"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.714013"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 11:52:54.714013"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.716338"], ["event", "view"], ["item_id", "6e32e240-f738-45bd-ba7b-7b4d2c2849f0"], ["updated_at", "2014-06-29 11:52:54.716338"], ["user_id", "cabb7cde-3cc6-4c3b-8e1b-a3d2dbd2f7dd"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.723428"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.723428"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.725613"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.725613"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 38ms (Views: 0.2ms | ActiveRecord: 0.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.770304"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.770304"]]
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.774863"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:52:54.774863"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.778105"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.778105"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.781501"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:52:54.781501"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.784608"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.784608"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:54.790818"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.790818"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"1a3e1d99-89ca-420f-b572-98eb65a0937d", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "1a3e1d99-89ca-420f-b572-98eb65a0937d"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '1a3e1d99-89ca-420f-b572-98eb65a0937d') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:52:54.798595"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.798595"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"414eb0fe-16fa-487d-95d1-7542edf8d930", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "414eb0fe-16fa-487d-95d1-7542edf8d930"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '414eb0fe-16fa-487d-95d1-7542edf8d930') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '414eb0fe-16fa-487d-95d1-7542edf8d930'  [["properties", nil], ["updated_at", "2014-06-29 11:52:54.802467"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.808203"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.808203"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.813214"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:52:54.813214"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.816690"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.816690"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.820122"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:52:54.820122"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:52:54.823267"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:52:54.823267"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"cb8a4585-e33e-4a1e-9bf5-39f2fe678b8b", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "cb8a4585-e33e-4a1e-9bf5-39f2fe678b8b"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != 'cb8a4585-e33e-4a1e-9bf5-39f2fe678b8b') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = 'cb8a4585-e33e-4a1e-9bf5-39f2fe678b8b'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 11:52:54.827035"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.7ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.9ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:11.944343"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:11.944343"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:11.952965"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:53:11.952965"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:11.956812"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:11.956812"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:11.960726"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:53:11.960726"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.5ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.3ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (2.0ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (1.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:11.968263"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:11.968263"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"d308bea8-53de-40f3-9374-fca264cffded", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.4ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "d308bea8-53de-40f3-9374-fca264cffded"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (1.8ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != 'd308bea8-53de-40f3-9374-fca264cffded') LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = 'd308bea8-53de-40f3-9374-fca264cffded'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 11:53:11.977361"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 8ms (Views: 0.3ms | ActiveRecord: 2.7ms)
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.3ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.6ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:12.000637"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.000637"]]
  [1m[35m (0.4ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.3ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:12.004241"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.004241"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.7ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.034110"], ["event", "view"], ["item_id", "af20d321-126c-4a53-9634-ca5e83474200"], ["updated_at", "2014-06-29 11:53:12.034110"], ["user_id", "10eb0ee1-1fa4-47fe-bcb4-dfb679f40218"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 28ms (Views: 0.3ms | ActiveRecord: 2.9ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.038848"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.038848"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.041004"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.041004"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[35mUser Load (0.3ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.3ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.046591"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 11:53:12.046591"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:12.048430"], ["event", "view"], ["item_id", "4f3567d5-2f8b-4129-8a3b-a02798d8581e"], ["updated_at", "2014-06-29 11:53:12.048430"], ["user_id", "ea8d1aa9-b113-41a8-90b1-db570c0bf6f5"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 1.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:12.052318"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.052318"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:12.054555"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.054555"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.059307"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 11:53:12.059307"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.061710"], ["event", "view"], ["item_id", "835cd637-d756-48c8-b2ef-18b74dae2c56"], ["updated_at", "2014-06-29 11:53:12.061710"], ["user_id", "f5efdde8-e9e8-447e-b62d-1839851d2191"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 1.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.068872"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.068872"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.071240"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.071240"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 42ms (Views: 0.2ms | ActiveRecord: 0.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.3ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.133818"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.133818"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.138944"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:53:12.138944"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (1.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.144101"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.144101"]]
  [1m[36m (0.3ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.148525"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:53:12.148525"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.152113"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.152113"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:12.159729"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.159729"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"ef50063d-0f24-4f5f-9b34-ab722cd0bf35", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "ef50063d-0f24-4f5f-9b34-ab722cd0bf35"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != 'ef50063d-0f24-4f5f-9b34-ab722cd0bf35') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:12.167376"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.167376"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"4ab4e3e4-4f35-4805-bfa3-6326dbbc5ceb", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "4ab4e3e4-4f35-4805-bfa3-6326dbbc5ceb"]]
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '4ab4e3e4-4f35-4805-bfa3-6326dbbc5ceb') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '4ab4e3e4-4f35-4805-bfa3-6326dbbc5ceb'  [["properties", nil], ["updated_at", "2014-06-29 11:53:12.171560"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.177638"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.177638"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:12.179872"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:12.179872"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.2ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.7ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.9ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:51.460861"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.460861"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:51.469754"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:53:51.469754"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:51.473741"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.473741"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:51.477803"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:53:51.477803"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:53:51.481504"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.481504"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"8b4177e3-8624-40e9-a893-80180fe9f61e", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.3ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "8b4177e3-8624-40e9-a893-80180fe9f61e"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.3ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '8b4177e3-8624-40e9-a893-80180fe9f61e') LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '8b4177e3-8624-40e9-a893-80180fe9f61e'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 11:53:51.486698"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 5ms (Views: 0.3ms | ActiveRecord: 1.0ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.500216"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.500216"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.502516"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.502516"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.506531"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.506531"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.508571"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.508571"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.512111"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.512111"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.514171"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.514171"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------
LayerApiTest: test_truth
------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.535796"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.535796"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.540401"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:53:51.540401"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.543782"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.543782"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.547389"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:53:51.547389"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.550797"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.550797"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 6ms (Views: 0.1ms | ActiveRecord: 0.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:53:51.561429"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.561429"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"728ac564-9e46-4506-a8a0-04e6d3a9c23f", "user"=>{"identifier"=>nil}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "728ac564-9e46-4506-a8a0-04e6d3a9c23f"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '728ac564-9e46-4506-a8a0-04e6d3a9c23f') LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:53:51.599711"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.599711"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"5657c2b1-e941-46f5-bf49-d6fd1c507c46", "user"=>{"identifier"=>"user@example.com"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "5657c2b1-e941-46f5-bf49-d6fd1c507c46"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '5657c2b1-e941-46f5-bf49-d6fd1c507c46') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '5657c2b1-e941-46f5-bf49-d6fd1c507c46'[0m  [["properties", nil], ["updated_at", "2014-06-29 11:53:51.604014"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.610712"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.610712"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.612762"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.612762"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.617985"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.617985"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:53:51.620090"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:53:51.620090"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.6ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:31.560540"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.560540"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:31.571965"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.571965"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:31.577572"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.577572"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:31.579857"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.579857"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:31.583812"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.583812"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:31.585753"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.585753"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:31.602781"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.602781"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:31.607690"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:54:31.607690"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:31.611113"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.611113"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:31.614572"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:54:31.614572"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:31.617803"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.617803"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"3c065523-323d-4888-a2a7-c9054b75d24d", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "3c065523-323d-4888-a2a7-c9054b75d24d"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '3c065523-323d-4888-a2a7-c9054b75d24d') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '3c065523-323d-4888-a2a7-c9054b75d24d'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 11:54:31.622463"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:54:31.634102"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.634102"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.1ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:54:31.636188"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.636188"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:54:31.641124"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.641124"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:54:31.645485"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:54:31.645485"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:54:31.648898"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.648898"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:54:31.652419"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:54:31.652419"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:54:31.655448"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.655448"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 38ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:31.697307"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.697307"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"6873a171-b977-4cf6-8cc5-bcefbb7714ca", "user"=>{"identifier"=>nil}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "6873a171-b977-4cf6-8cc5-bcefbb7714ca"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '6873a171-b977-4cf6-8cc5-bcefbb7714ca') LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:31.704687"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.704687"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"0c303302-fd23-4784-9708-db50cc884155", "user"=>{"identifier"=>"user@example.com"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "0c303302-fd23-4784-9708-db50cc884155"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '0c303302-fd23-4784-9708-db50cc884155') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '0c303302-fd23-4784-9708-db50cc884155'[0m  [["properties", nil], ["updated_at", "2014-06-29 11:54:31.708415"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:54:31.714354"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.714354"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:54:31.716322"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:31.716322"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.7ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.436456"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.436456"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.447817"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.447817"]]
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.453803"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.453803"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.456140"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.456140"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.459824"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.459824"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.461839"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.461839"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.468221"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.468221"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.470436"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.470436"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.479472"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.479472"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.481507"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.481507"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.495916"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.495916"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.506419"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:54:50.506419"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.510162"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.510162"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.513729"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:54:50.513729"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.516935"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.516935"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 7ms (Views: 0.1ms | ActiveRecord: 0.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:54:50.527917"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.527917"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"45d82cd9-bfca-47c2-849a-b142be1514a5", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "45d82cd9-bfca-47c2-849a-b142be1514a5"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '45d82cd9-bfca-47c2-849a-b142be1514a5') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 35ms (Views: 0.1ms | ActiveRecord: 0.8ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:54:50.567238"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.567238"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"9be7741b-a527-4ad1-a32a-f26b5f38950d", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "9be7741b-a527-4ad1-a32a-f26b5f38950d"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '9be7741b-a527-4ad1-a32a-f26b5f38950d') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '9be7741b-a527-4ad1-a32a-f26b5f38950d'  [["properties", nil], ["updated_at", "2014-06-29 11:54:50.571282"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.576641"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.576641"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.581707"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:54:50.581707"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.585559"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.585559"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.589088"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:54:50.589088"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:54:50.592187"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:54:50.592187"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"3a8f4788-f0e9-4417-b9e0-26843e0ce906", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "3a8f4788-f0e9-4417-b9e0-26843e0ce906"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '3a8f4788-f0e9-4417-b9e0-26843e0ce906') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '3a8f4788-f0e9-4417-b9e0-26843e0ce906'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 11:54:50.596381"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.7ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:25.784972"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.784972"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:25.793410"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:55:25.793410"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:25.797257"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.797257"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:25.800991"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:55:25.800991"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:25.804483"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.804483"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 12ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:55:25.821265"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.821265"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"cfa04163-8836-4bb7-a1e3-920c1ec1760b", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "cfa04163-8836-4bb7-a1e3-920c1ec1760b"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != 'cfa04163-8836-4bb7-a1e3-920c1ec1760b') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 4ms (Views: 0.1ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:55:25.829159"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.829159"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"1f457dea-dfe0-45e9-aeaa-e55c64150be2", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "1f457dea-dfe0-45e9-aeaa-e55c64150be2"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '1f457dea-dfe0-45e9-aeaa-e55c64150be2') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '1f457dea-dfe0-45e9-aeaa-e55c64150be2'  [["properties", nil], ["updated_at", "2014-06-29 11:55:25.833101"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:25.839887"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.839887"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:25.848255"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.848255"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:25.853973"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.853973"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:25.858397"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:55:25.858397"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:25.861744"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.861744"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:25.865110"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:55:25.865110"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:25.868370"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.868370"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"dc1cc5d8-81fd-462e-9e0d-cd8468e03de4", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "dc1cc5d8-81fd-462e-9e0d-cd8468e03de4"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.3ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != 'dc1cc5d8-81fd-462e-9e0d-cd8468e03de4') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = 'dc1cc5d8-81fd-462e-9e0d-cd8468e03de4'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 11:55:25.902944"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 34ms (Views: 0.3ms | ActiveRecord: 0.9ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------
LayerApiTest: test_truth
------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:55:25.909689"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.909689"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:55:25.912001"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.912001"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:55:25.917873"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.917873"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:55:25.920093"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.920093"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:55:25.923947"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.923947"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:55:25.926115"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.926115"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:55:25.929792"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.929792"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:55:25.931685"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:25.931685"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.7ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.034117"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.034117"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.046229"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.046229"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.053498"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.053498"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.055910"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.055910"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.059734"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.059734"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.061774"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.061774"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.065108"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.065108"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.067083"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.067083"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.072466"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.072466"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.076929"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:55:44.076929"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.080461"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.080461"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.089555"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 11:55:44.089555"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.092989"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.092989"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 6ms (Views: 0.1ms | ActiveRecord: 0.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:55:44.103369"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.103369"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"d915224d-47c9-4b47-b954-7f8ab9512b6c", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "d915224d-47c9-4b47-b954-7f8ab9512b6c"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != 'd915224d-47c9-4b47-b954-7f8ab9512b6c') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 4ms (Views: 0.1ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:55:44.111140"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.111140"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"03c0f39a-8b00-4663-aca2-1c1641ec51a7", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "03c0f39a-8b00-4663-aca2-1c1641ec51a7"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '03c0f39a-8b00-4663-aca2-1c1641ec51a7') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '03c0f39a-8b00-4663-aca2-1c1641ec51a7'  [["properties", nil], ["updated_at", "2014-06-29 11:55:44.115117"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 34ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.151731"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.151731"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.153791"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.153791"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.158468"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.158468"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.162871"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:55:44.162871"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.166219"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.166219"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.169550"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 11:55:44.169550"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:55:44.172753"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:55:44.172753"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"b4b30e9f-d984-4e20-92fc-f2aaa15fcb0b", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "b4b30e9f-d984-4e20-92fc-f2aaa15fcb0b"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != 'b4b30e9f-d984-4e20-92fc-f2aaa15fcb0b') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = 'b4b30e9f-d984-4e20-92fc-f2aaa15fcb0b'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 11:55:44.176588"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:57:45.921529"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:57:45.921529"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:57:45.933426"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:57:45.933426"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:57:45.942327"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:57:45.942327"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:57:45.944805"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:57:45.944805"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:57:45.950608"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:57:45.950608"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:57:45.952610"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:57:45.952610"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:57:45.956130"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:57:45.956130"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:57:45.958093"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:57:45.958093"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:57:45.961639"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:57:45.961639"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:57:45.963580"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:57:45.963580"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.9ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:58:50.988787"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:58:50.988787"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.5ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.9ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:58:51.005066"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:58:51.005066"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[35m (1.2ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 38ms (Views: 0.2ms | ActiveRecord: 10.3ms)
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:58:51.056528"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:58:51.056528"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:58:51.059275"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:58:51.059275"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.7ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:58:51.068057"], ["event", "view"], ["item_id", "a7026bc6-1e56-4d49-a2f7-cf82f8572946"], ["updated_at", "2014-06-29 11:58:51.068057"], ["user_id", "09b2611c-4fe8-4a9a-9be8-375905394a3f"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 8ms (Views: 0.3ms | ActiveRecord: 1.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:58:51.072677"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:58:51.072677"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:58:51.075054"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:58:51.075054"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 11:58:51.080363"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 11:58:51.080363"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:58:51.082122"], ["event", "view"], ["item_id", "a213e1f6-f440-45c5-8505-e48d1040d60b"], ["updated_at", "2014-06-29 11:58:51.082122"], ["user_id", "70f93aba-6f7d-4e6b-8f75-cc464aa2cc68"]]
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 37ms (Views: 0.4ms | ActiveRecord: 1.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:58:51.117348"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:58:51.117348"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:58:51.119624"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:58:51.119624"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 11:58:51.123935"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 11:58:51.123935"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.3ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:58:51.126609"], ["event", "view"], ["item_id", "20dabc44-c086-4a44-aacd-3e8879b1c830"], ["updated_at", "2014-06-29 11:58:51.126609"], ["user_id", "e36c7827-0a44-40bb-ab3d-cc66f20d5765"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:58:51.132406"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:58:51.132406"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:58:51.134414"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:58:51.134414"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:59:22.897979"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:22.897979"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:59:22.909760"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:22.909760"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 26ms (Views: 0.2ms | ActiveRecord: 1.5ms)
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:59:22.948233"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:22.948233"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:59:22.950416"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:22.950416"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.6ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:59:22.958225"], ["event", "view"], ["item_id", "55b64a06-4662-4835-82df-ce429f3dd8f4"], ["updated_at", "2014-06-29 11:59:22.958225"], ["user_id", "704222b9-5e97-4fe3-b012-516293c3551e"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 7ms (Views: 0.3ms | ActiveRecord: 1.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:59:22.963032"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:22.963032"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:59:22.965574"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:22.965574"]]
  [1m[35m (0.3ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.5ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.6ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 11:59:22.972399"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 11:59:22.972399"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:59:22.974328"], ["event", "view"], ["item_id", "d4702b57-0665-4957-a828-4cc58f92ed9a"], ["updated_at", "2014-06-29 11:59:22.974328"], ["user_id", "531a0f54-ef76-4ed6-aeb7-1771de649bd4"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 40ms (Views: 0.3ms | ActiveRecord: 2.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:59:23.011621"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:23.011621"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:59:23.014004"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:23.014004"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 11:59:23.018376"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 11:59:23.018376"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:59:23.020671"], ["event", "view"], ["item_id", "436b784c-d429-4e40-aaf0-f1e242de6d60"], ["updated_at", "2014-06-29 11:59:23.020671"], ["user_id", "f078b934-4da6-48a6-ae26-d3578d14998a"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 5ms (Views: 0.2ms | ActiveRecord: 1.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:59:23.025984"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:23.025984"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:59:23.028264"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:23.028264"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#index as JSON
  [1m[36mEvent Load (0.2ms)[0m  [1mSELECT "events".* FROM "events"[0m
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.9ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:59:34.908699"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:34.908699"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:59:34.921237"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:34.921237"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.4ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.4ms)
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:59:34.936873"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:34.936873"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:59:34.939300"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:34.939300"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.6ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:59:34.962147"], ["event", "view"], ["item_id", "1dbf14a4-8c2a-48b7-9327-10bc754e53e2"], ["updated_at", "2014-06-29 11:59:34.962147"], ["user_id", "c0d39e8f-89d7-46f7-872f-0e4e3b92d020"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.3ms | ActiveRecord: 2.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:59:34.966678"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:34.966678"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (2.7ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:59:34.969277"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:34.969277"]]
  [1m[36m (1.4ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[35mUser Load (0.9ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.4ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 11:59:34.981593"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 11:59:34.981593"]]
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:59:34.983913"], ["event", "view"], ["item_id", "1146da25-2e47-4120-aa7b-0fe86fbe0e54"], ["updated_at", "2014-06-29 11:59:34.983913"], ["user_id", "838ce7aa-58d0-4f17-be58-750a50da59d5"]]
  [1m[35m (0.4ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 9ms (Views: 0.3ms | ActiveRecord: 3.2ms)
  [1m[36m (2.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 11:59:34.991319"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:34.991319"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 11:59:34.993850"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:34.993850"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.4ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 11:59:34.999590"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 11:59:34.999590"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mItem Load (0.3ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:59:35.002530"], ["event", "view"], ["item_id", "a6aafa3f-1450-41b8-921c-3d8a9839387d"], ["updated_at", "2014-06-29 11:59:35.002530"], ["user_id", "307d3cbf-b4cd-416b-886a-4d491d83b216"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.3ms | ActiveRecord: 1.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 11:59:35.008953"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:35.008953"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 11:59:35.011195"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 11:59:35.011195"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 39ms (Views: 0.2ms | ActiveRecord: 0.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.9ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:01:02.473072"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:01:02.473072"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:01:02.485578"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:01:02.485578"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 26ms (Views: 0.2ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:01:02.523331"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:01:02.523331"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:01:02.525643"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:01:02.525643"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.6ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:01:02.533987"], ["event", "view"], ["item_id", "6ec3f5d4-9f14-45b1-98e6-1fccec8b1fd8"], ["updated_at", "2014-06-29 12:01:02.533987"], ["user_id", "af662ebb-50cb-4a40-86cc-f1497c369e07"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 8ms (Views: 0.3ms | ActiveRecord: 1.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:01:02.538388"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:01:02.538388"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:01:02.540416"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:01:02.540416"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:01:02.545346"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:01:02.545346"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:01:02.547037"], ["event", "view"], ["item_id", "7d371311-3b1a-440d-8f9d-4e554e2eb289"], ["updated_at", "2014-06-29 12:01:02.547037"], ["user_id", "16d77f7e-d2d1-4c13-af56-4ea1f0aa25aa"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 1.3ms)
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:01:02.582132"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:01:02.582132"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:01:02.584389"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:01:02.584389"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:01:02.588710"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:01:02.588710"]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.3ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:01:02.591343"], ["event", "view"], ["item_id", "c9e1357c-e71e-4340-b8cc-d0e141cf8d29"], ["updated_at", "2014-06-29 12:01:02.591343"], ["user_id", "df384cf6-259e-4089-a35c-4532838cff9e"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 1.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:01:02.597285"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:01:02.597285"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:01:02.599478"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:01:02.599478"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#index as JSON
  [1m[36mEvent Load (0.3ms)[0m  [1mSELECT "events".* FROM "events"[0m
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.3ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.9ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.1ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:03:16.187826"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:03:16.187826"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:03:16.200031"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:03:16.200031"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.4ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 6ms (Views: 0.6ms | ActiveRecord: 0.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:03:16.216536"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:03:16.216536"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:03:16.219169"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:03:16.219169"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 23ms (Views: 0.2ms | ActiveRecord: 1.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:03:16.250663"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:03:16.250663"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.3ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:03:16.253535"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:03:16.253535"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.7ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:03:16.293798"], ["event", "view"], ["item_id", "c8cec494-8ada-4624-88b0-c97646ddfdd2"], ["updated_at", "2014-06-29 12:03:16.293798"], ["user_id", "b5fcb674-7464-4f8c-a46a-a9b1b91ddd82"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 39ms (Views: 0.3ms | ActiveRecord: 1.3ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:03:16.297919"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:03:16.297919"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:03:16.300013"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:03:16.300013"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[35mUser Load (0.3ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:03:16.305160"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:03:16.305160"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:03:16.307129"], ["event", "view"], ["item_id", "5da1269c-99de-4e11-86fd-5f6c688bbe8c"], ["updated_at", "2014-06-29 12:03:16.307129"], ["user_id", "d9d2597d-2eec-473d-8418-cfc48c055a4a"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 1.6ms)
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:03:16.311200"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:03:16.311200"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:03:16.313519"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:03:16.313519"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:03:16.318407"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:03:16.318407"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:03:16.321052"], ["event", "view"], ["item_id", "abb982ca-1faf-4b50-a46e-243c3a8c2eda"], ["updated_at", "2014-06-29 12:03:16.321052"], ["user_id", "4701dc29-9b8b-4576-b921-c040230935f8"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 1.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (1.0ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:05:02.536854"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:02.536854"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:05:02.549377"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:02.549377"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 26ms (Views: 0.2ms | ActiveRecord: 2.0ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:05:02.585837"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:02.585837"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:05:02.588195"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:02.588195"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.3ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:05:02.595415"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:02.595415"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:05:02.597631"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:02.597631"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.8ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:05:02.636295"], ["event", "view"], ["item_id", "a86e190d-66ea-49ea-8d7c-4b8bcac1065a"], ["updated_at", "2014-06-29 12:05:02.636295"], ["user_id", "2b391929-4996-4cdc-9e68-a3beecf3da06"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 38ms
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:05:02.640738"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:02.640738"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:05:02.642890"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:02.642890"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[35mUser Load (0.3ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.3ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:05:02.648390"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:05:02.648390"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:05:02.650067"], ["event", "view"], ["item_id", "6fdad90a-45bb-4982-875e-7e76761cec2d"], ["updated_at", "2014-06-29 12:05:02.650067"], ["user_id", "d5764093-b88e-419f-b393-9188d6835402"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 500 Internal Server Error in 6ms
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:05:02.653577"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:02.653577"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:05:02.655637"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:02.655637"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:05:02.659763"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:05:02.659763"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:05:02.662012"], ["event", "view"], ["item_id", "779cf78a-1282-4558-b244-0880e6e87089"], ["updated_at", "2014-06-29 12:05:02.662012"], ["user_id", "a096d009-2f27-461a-9eac-551b3f9a088b"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 6ms
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.9ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:05:38.519306"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:38.519306"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:05:38.531822"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:38.531822"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 26ms (Views: 0.3ms | ActiveRecord: 1.5ms)
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:05:38.567148"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:38.567148"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:05:38.569491"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:38.569491"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.3ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 1ms (Views: 0.4ms | ActiveRecord: 0.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:05:38.578974"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:38.578974"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:05:38.581163"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:38.581163"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.7ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:05:38.620762"], ["event", "view"], ["item_id", "c6ce349e-9fbd-491c-ba48-635b0e6cb59b"], ["updated_at", "2014-06-29 12:05:38.620762"], ["user_id", "b0ba890b-f642-423f-9690-d1869304c52a"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 40ms
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:05:38.625773"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:38.625773"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:05:38.627740"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:38.627740"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[35mUser Load (0.3ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:05:38.632833"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:05:38.632833"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:05:38.634638"], ["event", "view"], ["item_id", "4e377b03-c2ed-45a6-9b7c-5321c7e85af6"], ["updated_at", "2014-06-29 12:05:38.634638"], ["user_id", "29e78ada-9f95-4237-9863-ac2927f0e55c"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 500 Internal Server Error in 7ms
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:05:38.638952"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:38.638952"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.1ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:05:38.640930"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:05:38.640930"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:05:38.644977"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:05:38.644977"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:05:38.647290"], ["event", "view"], ["item_id", "9e096e94-9b01-4ca9-8dcf-4793be766cef"], ["updated_at", "2014-06-29 12:05:38.647290"], ["user_id", "c9deaf05-e098-4528-b1ec-d90f0946a872"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 6ms
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.1ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:07:50.200320"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:07:50.200320"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:07:50.213201"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:07:50.213201"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.7ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 0.7ms)
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:07:50.228767"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:07:50.228767"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:07:50.231072"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:07:50.231072"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 23ms (Views: 0.2ms | ActiveRecord: 1.5ms)
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:07:50.262309"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:07:50.262309"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:07:50.264689"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:07:50.264689"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.6ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:07:50.273198"], ["event", "view"], ["item_id", "687c94e3-ed22-4b30-9a61-4845b7e9733e"], ["updated_at", "2014-06-29 12:07:50.273198"], ["user_id", "8c399952-01b8-48ff-8ce2-fe396f41535c"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 43ms (Views: 2.5ms | ActiveRecord: 1.4ms)
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:07:50.313371"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:07:50.313371"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:07:50.315465"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:07:50.315465"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:07:50.320487"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:07:50.320487"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:07:50.322254"], ["event", "view"], ["item_id", "6e30f1df-686d-426e-b1e7-34186514ebe6"], ["updated_at", "2014-06-29 12:07:50.322254"], ["user_id", "09f51671-bc89-456e-9c32-5101f9fcbee4"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:07:50.326536"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:07:50.326536"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:07:50.328611"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:07:50.328611"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:07:50.332843"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:07:50.332843"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:07:50.335216"], ["event", "view"], ["item_id", "f19313ed-c366-40ff-9853-bcb7ef90ca53"], ["updated_at", "2014-06-29 12:07:50.335216"], ["user_id", "2f019a25-d8b3-4937-afc6-4dd326816793"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.3ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:08:01.878332"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:01.878332"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:08:01.890946"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:01.890946"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.6ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:01.914625"], ["event", "view"], ["item_id", "a82344ce-e65c-449d-9848-fef683d56973"], ["updated_at", "2014-06-29 12:08:01.914625"], ["user_id", "8bab1e37-e07c-4bca-880c-0e351e7d0504"]]
  [1m[35m (5.8ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 31ms (Views: 4.8ms | ActiveRecord: 8.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:01.929924"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:01.929924"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:01.932109"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:01.932109"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:01.937540"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:08:01.937540"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:08:01.939375"], ["event", "view"], ["item_id", "629dffe9-2407-4736-adcf-3f123cc06057"], ["updated_at", "2014-06-29 12:08:01.939375"], ["user_id", "1202cd20-c71c-4e63-9e59-278e65b7f31b"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.8ms | ActiveRecord: 1.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:08:01.943728"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:01.943728"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:08:01.945823"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:01.945823"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:01.950271"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:08:01.950271"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:01.952572"], ["event", "view"], ["item_id", "7d5ba41b-18ed-41c1-bf8a-63db32c82f56"], ["updated_at", "2014-06-29 12:08:01.952572"], ["user_id", "6a4d86d6-1520-446f-a934-eb1d0c8707dd"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.3ms)
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:01.958590"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:01.958590"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.1ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:01.960620"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:01.960620"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 39ms (Views: 0.2ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:02.006403"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:02.006403"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:02.008514"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:02.008514"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#index as JSON
  [1m[36mEvent Load (0.2ms)[0m  [1mSELECT "events".* FROM "events"[0m
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.1ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:08:12.986159"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:12.986159"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:08:12.998191"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:12.998191"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.3ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 0.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:13.013060"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:13.013060"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:13.015340"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:13.015340"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 22ms (Views: 0.2ms | ActiveRecord: 1.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:13.046216"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:13.046216"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:13.048827"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:13.048827"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.5ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.3ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:08:13.056726"], ["event", "view"], ["item_id", "8fd16bfb-209d-4a71-a94d-5e356eb2fbc0"], ["updated_at", "2014-06-29 12:08:13.056726"], ["user_id", "3b07c043-3c2f-4bcd-84d4-39ed996fac35"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 42ms (Views: 35.3ms | ActiveRecord: 1.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:08:13.096474"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:13.096474"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:08:13.098807"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:13.098807"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:08:13.104022"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:08:13.104022"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:13.105752"], ["event", "view"], ["item_id", "7a9c75f8-3ac3-4a26-a9e3-6eb54b0c73f6"], ["updated_at", "2014-06-29 12:08:13.105752"], ["user_id", "d04a938c-c57e-4699-bfa3-353d63e87b83"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:13.110189"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:13.110189"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:13.112392"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:13.112392"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:08:13.116869"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:08:13.116869"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:08:13.119228"], ["event", "view"], ["item_id", "4ebd652b-6806-4e28-9800-b2dd2a561972"], ["updated_at", "2014-06-29 12:08:13.119228"], ["user_id", "d967c4b1-abf5-4043-9353-a09bcb63d2ca"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.3ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.1ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:08:20.830853"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:20.830853"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:08:20.843070"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:20.843070"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.7ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:20.872850"], ["event", "view"], ["item_id", "2715e8f1-a44a-4376-b35f-1617a406935d"], ["updated_at", "2014-06-29 12:08:20.872850"], ["user_id", "c47d98d9-ef9e-4ee7-a605-e488e6f02437"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 31ms (Views: 4.5ms | ActiveRecord: 2.8ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:20.882061"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:20.882061"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:20.884320"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:20.884320"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.3ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:20.889599"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:08:20.889599"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:08:20.891439"], ["event", "view"], ["item_id", "75977b7a-f062-42ee-bb50-6a7188d9b814"], ["updated_at", "2014-06-29 12:08:20.891439"], ["user_id", "47b51d0f-1d5a-4e49-b003-fbe8e453a6ec"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:08:20.895646"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:20.895646"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:08:20.897698"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:20.897698"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:20.902028"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:08:20.902028"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:20.904603"], ["event", "view"], ["item_id", "6eed7d9e-67f4-4380-a1ac-e3c796747666"], ["updated_at", "2014-06-29 12:08:20.904603"], ["user_id", "f1ed560f-d28f-498e-a398-b4f65d94a8b9"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:20.920175"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:20.920175"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:20.922705"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:20.922705"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 39ms (Views: 0.2ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------
LayerApiTest: test_truth
------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:20.970113"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:20.970113"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:20.975020"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:08:20.975020"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:20.978819"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:20.978819"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:20.982262"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:08:20.982262"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:20.985859"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:20.985859"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1
  [1m[36m (0.2ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:08:20.992962"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:20.992962"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"9abc22f9-6f18-4424-b261-2dd3e803adcf", "user"=>{"identifier"=>nil}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "9abc22f9-6f18-4424-b261-2dd3e803adcf"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '9abc22f9-6f18-4424-b261-2dd3e803adcf') LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:08:21.000975"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:21.000975"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"9b9dd6ad-79c7-4b13-8531-5494e287c1ca", "user"=>{"identifier"=>"user@example.com"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "9b9dd6ad-79c7-4b13-8531-5494e287c1ca"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '9b9dd6ad-79c7-4b13-8531-5494e287c1ca') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '9b9dd6ad-79c7-4b13-8531-5494e287c1ca'[0m  [["properties", nil], ["updated_at", "2014-06-29 12:08:21.005313"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.9ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:21.012395"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:21.012395"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:21.017100"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:08:21.017100"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:21.020896"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:21.020896"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:21.024596"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:08:21.024596"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:08:21.028498"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:21.028498"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"c943c718-42ad-42e7-b74e-4941f45879df", "item"=>{"name"=>"item 2"}}
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1[0m  [["id", "c943c718-42ad-42e7-b74e-4941f45879df"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != 'c943c718-42ad-42e7-b74e-4941f45879df') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = 'c943c718-42ad-42e7-b74e-4941f45879df'  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 12:08:21.032704"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:08:21.040732"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:21.040732"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:08:21.042994"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:08:21.042994"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.2ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 1ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.9ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.332599"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.332599"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.344825"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.344825"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.4ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.4ms)
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:04.360182"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.360182"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:04.362606"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.362606"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.7ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.385681"], ["event", "view"], ["item_id", "f261523b-1b7c-438e-b2ac-2ff82f4c6b41"], ["updated_at", "2014-06-29 12:09:04.385681"], ["user_id", "4a8f450e-9eb8-4b4f-a8cc-ea75710e4b01"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 27ms (Views: 4.7ms | ActiveRecord: 2.5ms)
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.395127"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.395127"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.397540"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.397540"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[35mUser Load (0.4ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.403155"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:09:04.403155"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:04.404987"], ["event", "view"], ["item_id", "d5129ff4-1998-496c-8b25-e1b2e4192d77"], ["updated_at", "2014-06-29 12:09:04.404987"], ["user_id", "3a716fdd-f2cc-440e-a669-cb65bd0cb6fb"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 7ms (Views: 0.7ms | ActiveRecord: 1.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:04.409232"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.409232"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:04.411491"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.411491"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.416317"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:09:04.416317"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.418937"], ["event", "view"], ["item_id", "c241ae6b-1c48-4ac7-bec1-c37a6c6cc4c5"], ["updated_at", "2014-06-29 12:09:04.418937"], ["user_id", "348d8790-2fb8-4d1c-844b-fb58bb715dcf"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.8ms | ActiveRecord: 1.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.424661"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.424661"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.429569"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:09:04.429569"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.433827"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.433827"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.437633"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:09:04.437633"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.441056"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.441056"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"5352a3f1-27d0-4b32-9ecf-a7c44503dd8f", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "5352a3f1-27d0-4b32-9ecf-a7c44503dd8f"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.3ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '5352a3f1-27d0-4b32-9ecf-a7c44503dd8f') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '5352a3f1-27d0-4b32-9ecf-a7c44503dd8f'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 12:09:04.445759"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.8ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:04.452293"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.452293"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:04.454475"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.454475"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 7ms (Views: 0.2ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:04.500762"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.500762"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:04.505402"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:09:04.505402"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:04.509179"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.509179"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:04.512718"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:09:04.512718"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:04.516173"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.516173"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.522606"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.522606"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"415b7a2f-2e48-47ca-8ac2-4517479d2e54", "user"=>{"identifier"=>nil}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "415b7a2f-2e48-47ca-8ac2-4517479d2e54"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '415b7a2f-2e48-47ca-8ac2-4517479d2e54') LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:09:04.529843"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:04.529843"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"9dcc22ae-cbfd-4ce0-a44a-3e8c54c74504", "user"=>{"identifier"=>"user@example.com"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "9dcc22ae-cbfd-4ce0-a44a-3e8c54c74504"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '9dcc22ae-cbfd-4ce0-a44a-3e8c54c74504') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '9dcc22ae-cbfd-4ce0-a44a-3e8c54c74504'[0m  [["properties", nil], ["updated_at", "2014-06-29 12:09:04.534199"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------
LayerApiTest: test_truth
------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.9ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:09:32.828392"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:32.828392"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:09:32.837364"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:09:32.837364"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 2.6ms | ActiveRecord: 0.6ms)
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:09:32.844127"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:32.844127"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:09:32.848631"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:09:32.848631"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:09:32.852365"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:32.852365"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 13ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:32.869721"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:32.869721"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"93cbde34-1082-4337-9de8-6ba3bb0a876c", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "93cbde34-1082-4337-9de8-6ba3bb0a876c"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '93cbde34-1082-4337-9de8-6ba3bb0a876c') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 4ms (Views: 0.1ms | ActiveRecord: 0.8ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:32.878805"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:32.878805"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"1db15287-eb77-4431-90ac-93bf0f9e7a3a", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "1db15287-eb77-4431-90ac-93bf0f9e7a3a"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '1db15287-eb77-4431-90ac-93bf0f9e7a3a') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '1db15287-eb77-4431-90ac-93bf0f9e7a3a'  [["properties", nil], ["updated_at", "2014-06-29 12:09:32.883143"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:09:32.900267"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:32.900267"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:09:32.909128"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:32.909128"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.6ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:32.960785"], ["event", "view"], ["item_id", "e9281b40-5a7f-4f05-a0b0-c56ccb36036d"], ["updated_at", "2014-06-29 12:09:32.960785"], ["user_id", "a13202a8-4d5b-4853-b7cf-74227c56daf7"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 52ms (Views: 2.5ms | ActiveRecord: 2.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:32.967818"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:32.967818"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:32.970058"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:32.970058"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:32.975113"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:09:32.975113"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:09:32.976989"], ["event", "view"], ["item_id", "72469ca6-905f-49d4-a3a6-2383599ceac1"], ["updated_at", "2014-06-29 12:09:32.976989"], ["user_id", "8a9d2e70-646f-4e1e-baa3-86e21a769787"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:09:32.981351"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:32.981351"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:09:32.983353"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:32.983353"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:32.987515"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:09:32.987515"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:32.989833"], ["event", "view"], ["item_id", "eca7ebd4-9a78-43c4-8b25-a1268e4f30b7"], ["updated_at", "2014-06-29 12:09:32.989833"], ["user_id", "019cf4c9-9e10-4874-a0ee-29dbdf24650d"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------
LayerApiTest: test_truth
------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:32.996726"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:32.996726"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:33.001685"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:09:33.001685"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:33.005285"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:33.005285"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:33.008979"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:09:33.008979"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:33.012996"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:33.012996"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"49608ad7-3c2e-40a5-920a-6c8e246d63bf", "item"=>{"name"=>"item 2"}}
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1[0m  [["id", "49608ad7-3c2e-40a5-920a-6c8e246d63bf"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '49608ad7-3c2e-40a5-920a-6c8e246d63bf') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '49608ad7-3c2e-40a5-920a-6c8e246d63bf'  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 12:09:33.017398"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:09:33.023086"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:33.023086"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:09:33.025300"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:33.025300"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.2ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 1ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:33.034315"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:33.034315"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:09:33.036409"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:09:33.036409"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 4ms (Views: 0.2ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.7ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:10:34.862921"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:34.862921"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:10:34.875265"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:34.875265"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 26ms (Views: 0.2ms | ActiveRecord: 1.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:10:34.912404"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:34.912404"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:10:34.914665"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:34.914665"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.7ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:34.953228"], ["event", "view"], ["item_id", "1a130cbb-c7cf-494f-844d-0e46d83f7c7b"], ["updated_at", "2014-06-29 12:10:34.953228"], ["user_id", "6f4716af-2f5b-4abf-bfaa-9ed2b5855d07"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 43ms (Views: 4.9ms | ActiveRecord: 1.4ms)
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:34.962817"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:34.962817"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.1ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:34.964891"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:34.964891"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.1ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:34.969988"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:10:34.969988"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:10:34.971655"], ["event", "view"], ["item_id", "e9fb4efd-057c-4e2d-a4e1-f850c4a154ce"], ["updated_at", "2014-06-29 12:10:34.971655"], ["user_id", "1e5f6f63-d421-4614-9f2a-d6aae0a023b7"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.3ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:10:34.976074"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:34.976074"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:10:34.978417"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:34.978417"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:34.982624"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:10:34.982624"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:34.984872"], ["event", "view"], ["item_id", "2e038f38-2861-4165-910d-84782d35c018"], ["updated_at", "2014-06-29 12:10:34.984872"], ["user_id", "b7be47ba-0821-45bf-b5c6-8af3ceca1e28"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:34.990929"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:34.990929"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:34.993117"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:34.993117"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#index as JSON
  [1m[36mEvent Load (0.2ms)[0m  [1mSELECT "events".* FROM "events"[0m
Completed 200 OK in 1ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:10:35.000080"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:35.000080"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:10:35.004562"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:10:35.004562"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:10:35.008246"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:35.008246"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:10:35.012214"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:10:35.012214"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:10:35.015806"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:35.015806"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:35.022413"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:35.022413"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"9e885937-2c7c-49ae-a428-f4b2d4812fee", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "9e885937-2c7c-49ae-a428-f4b2d4812fee"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '9e885937-2c7c-49ae-a428-f4b2d4812fee') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 4ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:35.030728"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:35.030728"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"f42a78e2-3421-48c5-92bb-07fdbb3af0e2", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "f42a78e2-3421-48c5-92bb-07fdbb3af0e2"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != 'f42a78e2-3421-48c5-92bb-07fdbb3af0e2') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = 'f42a78e2-3421-48c5-92bb-07fdbb3af0e2'  [["properties", nil], ["updated_at", "2014-06-29 12:10:35.035154"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:10:35.051728"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:35.051728"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:10:35.056404"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:10:35.056404"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:10:35.060161"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:35.060161"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:10:35.064100"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:10:35.064100"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:10:35.067625"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:35.067625"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"84119ea7-d5bc-49b5-be73-f14c3bfe0923", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "84119ea7-d5bc-49b5-be73-f14c3bfe0923"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '84119ea7-d5bc-49b5-be73-f14c3bfe0923') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '84119ea7-d5bc-49b5-be73-f14c3bfe0923'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 12:10:35.071690"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:10:47.896577"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:47.896577"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:10:47.909514"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:47.909514"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.4ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:47.922839"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:47.922839"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:47.927701"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:10:47.927701"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 5ms (Views: 2.7ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:47.933942"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:47.933942"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:47.943323"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:10:47.943323"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:47.947222"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:47.947222"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 7ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:10:47.959381"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:47.959381"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"1fd839b6-b5e6-4f98-a56d-9d11af3c2d50", "user"=>{"identifier"=>nil}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "1fd839b6-b5e6-4f98-a56d-9d11af3c2d50"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '1fd839b6-b5e6-4f98-a56d-9d11af3c2d50') LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 4ms (Views: 0.1ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:10:47.967906"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:47.967906"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"727b5340-f76b-4be5-8d48-271433d34966", "user"=>{"identifier"=>"user@example.com"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "727b5340-f76b-4be5-8d48-271433d34966"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '727b5340-f76b-4be5-8d48-271433d34966') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '727b5340-f76b-4be5-8d48-271433d34966'[0m  [["properties", nil], ["updated_at", "2014-06-29 12:10:47.971798"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.3ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:48.011249"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:48.011249"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:48.016223"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:10:48.016223"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 4ms (Views: 1.1ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:48.020846"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:48.020846"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:48.024678"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:10:48.024678"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:48.028331"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:48.028331"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"3020a578-4cba-4010-9388-7f661b5a70cc", "item"=>{"name"=>"item 2"}}
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1[0m  [["id", "3020a578-4cba-4010-9388-7f661b5a70cc"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '3020a578-4cba-4010-9388-7f661b5a70cc') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '3020a578-4cba-4010-9388-7f661b5a70cc'  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 12:10:48.032644"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:10:48.038799"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:48.038799"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:10:48.040869"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:48.040869"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 12ms (Views: 0.2ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:10:48.061416"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:48.061416"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:10:48.063677"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:48.063677"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.5ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:48.071472"], ["event", "view"], ["item_id", "a66419c8-a2bf-49c5-ae54-86c17179e0e3"], ["updated_at", "2014-06-29 12:10:48.071472"], ["user_id", "e62f6cfe-b3e2-4d20-9b2c-ea865d9fc53d"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 9ms (Views: 1.8ms | ActiveRecord: 1.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:48.077236"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:48.077236"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:48.079263"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:48.079263"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:48.084000"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:10:48.084000"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:10:48.085774"], ["event", "view"], ["item_id", "7f8f5965-2826-4ae4-abd1-5a6f259d81ae"], ["updated_at", "2014-06-29 12:10:48.085774"], ["user_id", "005d389c-c97b-4d09-bd12-d743c35b35c5"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:10:48.090141"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:48.090141"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:10:48.092328"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:10:48.092328"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:48.096633"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:10:48.096633"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:10:48.098796"], ["event", "view"], ["item_id", "da87ea34-abe7-4417-ad5b-945949fc7877"], ["updated_at", "2014-06-29 12:10:48.098796"], ["user_id", "bfd089fc-570e-4fab-a6e1-d2140084484a"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:00.873580"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:00.873580"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:00.882850"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:11:00.882850"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 2.9ms | ActiveRecord: 0.7ms)
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:00.890003"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:00.890003"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:00.894340"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:11:00.894340"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:00.898775"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:00.898775"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 13ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:00.916700"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:00.916700"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"ea4305f8-e200-4633-9caf-a90815c21004", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "ea4305f8-e200-4633-9caf-a90815c21004"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != 'ea4305f8-e200-4633-9caf-a90815c21004') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 4ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:00.925503"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:00.925503"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"b2c941e8-b04d-4076-8506-a97cc0e882de", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "b2c941e8-b04d-4076-8506-a97cc0e882de"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != 'b2c941e8-b04d-4076-8506-a97cc0e882de') LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = 'b2c941e8-b04d-4076-8506-a97cc0e882de'  [["properties", nil], ["updated_at", "2014-06-29 12:11:00.929702"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:00.945724"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:00.945724"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:00.951331"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:11:00.951331"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 1.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:00.956273"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:00.956273"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:00.960560"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:11:00.960560"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:00.964158"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:00.964158"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"ca41be3a-0f43-482e-ab92-5bc6e95d5452", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "ca41be3a-0f43-482e-ab92-5bc6e95d5452"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != 'ca41be3a-0f43-482e-ab92-5bc6e95d5452') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = 'ca41be3a-0f43-482e-ab92-5bc6e95d5452'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 12:11:00.968497"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:01.015521"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:01.015521"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:01.017814"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:01.017814"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 16ms (Views: 0.2ms | ActiveRecord: 1.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:01.041742"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:01.041742"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:01.044008"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:01.044008"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.5ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:01.051552"], ["event", "view"], ["item_id", "7728aa83-01ca-4c94-846c-ecc68ec6dfcc"], ["updated_at", "2014-06-29 12:11:01.051552"], ["user_id", "317ec620-95cc-4ac4-b0d0-82fdbbd97b77"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 1.9ms | ActiveRecord: 1.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:01.057804"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:01.057804"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:01.059794"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:01.059794"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:11:01.064782"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:11:01.064782"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:01.066428"], ["event", "view"], ["item_id", "84aef55d-575c-4a5f-9703-0b55915bf786"], ["updated_at", "2014-06-29 12:11:01.066428"], ["user_id", "ae635597-7f92-4a40-a636-613cbb97eeef"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:01.070665"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:01.070665"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:01.072835"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:01.072835"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:11:01.077483"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:11:01.077483"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:01.079947"], ["event", "view"], ["item_id", "fdb5ca87-f166-4dfe-b099-461b60809c3f"], ["updated_at", "2014-06-29 12:11:01.079947"], ["user_id", "3c4d7336-2a32-4d30-93ed-687119f41b7c"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:01.087562"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:01.087562"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:01.089809"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:01.089809"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.2ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 1ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.7ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:13.989304"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:13.989304"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:14.001728"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.001728"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.7ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.3ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:14.031291"], ["event", "view"], ["item_id", "c1894d39-f34b-4646-9612-432e01dc2873"], ["updated_at", "2014-06-29 12:11:14.031291"], ["user_id", "5a4397e6-e187-45df-abf9-8e3101bdb942"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 31ms (Views: 4.9ms | ActiveRecord: 2.8ms)
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:14.041032"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.041032"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:14.043306"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.043306"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:14.048457"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:11:14.048457"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:14.050283"], ["event", "view"], ["item_id", "5765ce03-0062-4a98-a02c-a9a163e629ef"], ["updated_at", "2014-06-29 12:11:14.050283"], ["user_id", "aca09a7b-e744-4228-bd46-dcf222f8fa37"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:14.054498"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.054498"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:14.056537"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.056537"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:14.060672"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:11:14.060672"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:14.063053"], ["event", "view"], ["item_id", "e31ed3a1-b18d-42ca-ad05-7837267fff88"], ["updated_at", "2014-06-29 12:11:14.063053"], ["user_id", "0078de6f-9237-4f3c-aad2-5fd7ec0c8406"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:14.077883"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.077883"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:14.082745"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:11:14.082745"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:14.086842"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.086842"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:14.090617"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:11:14.090617"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:14.094266"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.094266"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.4ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1
  [1m[36m (0.3ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 39ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:14.139446"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.139446"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"499527d3-babc-4fcc-b7c9-55664cb0ed95", "user"=>{"identifier"=>nil}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "499527d3-babc-4fcc-b7c9-55664cb0ed95"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '499527d3-babc-4fcc-b7c9-55664cb0ed95') LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:14.148155"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.148155"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"58c7082d-b9b5-4062-991d-d00431e3b4ac", "user"=>{"identifier"=>"user@example.com"}}
  [1m[35mUser Load (0.3ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "58c7082d-b9b5-4062-991d-d00431e3b4ac"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '58c7082d-b9b5-4062-991d-d00431e3b4ac') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '58c7082d-b9b5-4062-991d-d00431e3b4ac'[0m  [["properties", nil], ["updated_at", "2014-06-29 12:11:14.152313"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.9ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:14.158932"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.158932"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:14.160974"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.160974"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#index as JSON
  [1m[36mEvent Load (0.2ms)[0m  [1mSELECT "events".* FROM "events"[0m
Completed 200 OK in 1ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:14.169233"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.169233"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:14.171393"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.171393"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:14.182434"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.182434"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:14.187418"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:11:14.187418"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:14.191188"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.191188"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:14.194791"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:11:14.194791"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:14.198273"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:14.198273"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"f1bf309e-30c8-4bf1-9212-999823ae129c", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "f1bf309e-30c8-4bf1-9212-999823ae129c"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != 'f1bf309e-30c8-4bf1-9212-999823ae129c') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = 'f1bf309e-30c8-4bf1-9212-999823ae129c'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 12:11:14.202616"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:48.936606"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:48.936606"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:48.949208"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:48.949208"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.7ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:48.977463"], ["event", "view"], ["item_id", "435ccf9d-43c5-4825-9750-3996e5a2cbb5"], ["updated_at", "2014-06-29 12:11:48.977463"], ["user_id", "a6b4c6ed-9d75-43d8-8c95-0d16c04b36fc"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 31ms (Views: 4.8ms | ActiveRecord: 2.6ms)
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:48.987089"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:48.987089"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:48.989654"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:48.989654"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:48.994684"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:11:48.994684"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:48.996410"], ["event", "view"], ["item_id", "3969e2a6-d234-478b-b424-b0b7510ee2f1"], ["updated_at", "2014-06-29 12:11:48.996410"], ["user_id", "037d4e80-ce59-445d-87d5-3fc40119bc16"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:49.001028"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:49.001028"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:49.003408"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:49.003408"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:49.007819"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:11:49.007819"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:49.010249"], ["event", "view"], ["item_id", "11e50864-6b3d-42fe-b9ad-f78e856eb9cf"], ["updated_at", "2014-06-29 12:11:49.010249"], ["user_id", "cfe31caf-998c-4eae-8270-b82efd7030a7"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:49.016912"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:49.016912"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.3ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:49.019834"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:49.019834"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 40ms (Views: 0.2ms | ActiveRecord: 0.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:49.068986"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:49.068986"]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:49.071372"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:49.071372"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#index as JSON
  [1m[36mEvent Load (0.2ms)[0m  [1mSELECT "events".* FROM "events"[0m
Completed 200 OK in 1ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:49.078368"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:49.078368"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:49.083241"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:11:49.083241"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:49.087468"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:49.087468"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:49.091323"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:11:49.091323"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:11:49.094765"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:49.094765"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:49.101772"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:49.101772"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"40ff0ffe-9552-4ce0-b972-ad9ae0f91eb5", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "40ff0ffe-9552-4ce0-b972-ad9ae0f91eb5"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '40ff0ffe-9552-4ce0-b972-ad9ae0f91eb5') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 5ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:11:49.111620"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:49.111620"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"df1a3045-2301-4b55-b8c4-a478930e1a5b", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "df1a3045-2301-4b55-b8c4-a478930e1a5b"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != 'df1a3045-2301-4b55-b8c4-a478930e1a5b') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = 'df1a3045-2301-4b55-b8c4-a478930e1a5b'  [["properties", nil], ["updated_at", "2014-06-29 12:11:49.115726"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:49.122357"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:49.122357"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:49.127324"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:11:49.127324"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:49.131039"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:49.131039"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:49.134884"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:11:49.134884"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.6ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:11:49.139224"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:11:49.139224"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"82fa7ce4-5bd8-44f8-8a6f-e179227dfd9e", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "82fa7ce4-5bd8-44f8-8a6f-e179227dfd9e"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '82fa7ce4-5bd8-44f8-8a6f-e179227dfd9e') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '82fa7ce4-5bd8-44f8-8a6f-e179227dfd9e'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 12:11:49.144149"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.7ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:13:38.089475"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.089475"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:13:38.100859"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.100859"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.7ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:13:38.131020"], ["event", "view"], ["item_id", "c301eb67-c248-4a6a-826f-74678af2111d"], ["updated_at", "2014-06-29 12:13:38.131020"], ["user_id", "7d2c6ab8-007b-434b-9b0e-a5fafc9420c0"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 31ms (Views: 4.5ms | ActiveRecord: 2.6ms)
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:13:38.140188"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.140188"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:13:38.142406"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.142406"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.1ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:13:38.147393"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:13:38.147393"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:13:38.149192"], ["event", "view"], ["item_id", "851c6ed5-4c6e-4aac-a56c-f3263db6aa37"], ["updated_at", "2014-06-29 12:13:38.149192"], ["user_id", "1e64280c-795f-4f53-bf29-a96a2e9829f4"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.3ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:13:38.153210"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.153210"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:13:38.155218"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.155218"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:13:38.159197"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:13:38.159197"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:13:38.161483"], ["event", "view"], ["item_id", "623c64d9-38b3-437a-b4bd-809244cb2fae"], ["updated_at", "2014-06-29 12:13:38.161483"], ["user_id", "6365818d-79aa-4aaf-83f4-005496cc780f"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.2ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------
LayerApiTest: test_truth
------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.3ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:13:38.179926"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.179926"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:13:38.185063"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:13:38.185063"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:13:38.189238"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.189238"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:13:38.193126"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:13:38.193126"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:13:38.196756"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.196756"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"5f752af5-cf85-4e5f-b9c0-1d26e471e5c7", "item"=>{"name"=>"item 2"}}
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1[0m  [["id", "5f752af5-cf85-4e5f-b9c0-1d26e471e5c7"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '5f752af5-cf85-4e5f-b9c0-1d26e471e5c7') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '5f752af5-cf85-4e5f-b9c0-1d26e471e5c7'  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 12:13:38.201963"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.9ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:13:38.208910"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.208910"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:13:38.246897"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.246897"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 7ms (Views: 0.2ms | ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:13:38.263349"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.263349"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:13:38.268553"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:13:38.268553"]]
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:13:38.273015"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.273015"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:13:38.277164"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:13:38.277164"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:13:38.280905"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.280905"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:13:38.287437"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.287437"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"4b21f1b2-0731-4338-8c86-2325ddf4cd10", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "4b21f1b2-0731-4338-8c86-2325ddf4cd10"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '4b21f1b2-0731-4338-8c86-2325ddf4cd10') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:13:38.294352"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.294352"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"ad2b6f1a-3deb-47bc-aa52-e31e30743baa", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "ad2b6f1a-3deb-47bc-aa52-e31e30743baa"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != 'ad2b6f1a-3deb-47bc-aa52-e31e30743baa') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = 'ad2b6f1a-3deb-47bc-aa52-e31e30743baa'  [["properties", nil], ["updated_at", "2014-06-29 12:13:38.298240"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:13:38.304710"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.304710"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:13:38.307078"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:13:38.307078"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.3ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 1ms (Views: 0.5ms | ActiveRecord: 0.3ms)
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.7ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.9ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:14:06.947594"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:06.947594"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:14:06.956175"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:14:06.956175"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 2.5ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:14:06.962457"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:06.962457"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:14:06.966688"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:14:06.966688"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:14:06.970777"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:06.970777"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 13ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:06.988397"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:06.988397"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"63607f84-89d8-4ae8-a0a0-25f8a458e5e4", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "63607f84-89d8-4ae8-a0a0-25f8a458e5e4"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '63607f84-89d8-4ae8-a0a0-25f8a458e5e4') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 4ms (Views: 0.1ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:06.996711"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:06.996711"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"73f157dc-0cad-46f1-aacb-8ac0db96ffa1", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "73f157dc-0cad-46f1-aacb-8ac0db96ffa1"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '73f157dc-0cad-46f1-aacb-8ac0db96ffa1') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '73f157dc-0cad-46f1-aacb-8ac0db96ffa1'  [["properties", nil], ["updated_at", "2014-06-29 12:14:07.000672"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:07.013158"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:07.013158"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:07.018495"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:14:07.018495"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 1.1ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:07.023066"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:07.023066"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:07.026597"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:14:07.026597"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:07.029879"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:07.029879"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"a9a9f4e4-c400-4202-a9eb-23a84b828cfa", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "a9a9f4e4-c400-4202-a9eb-23a84b828cfa"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != 'a9a9f4e4-c400-4202-a9eb-23a84b828cfa') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = 'a9a9f4e4-c400-4202-a9eb-23a84b828cfa'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 12:14:07.033750"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:07.082497"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:07.082497"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:07.084820"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:07.084820"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.5ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:07.104957"], ["event", "view"], ["item_id", "c34dea28-f64e-4c6b-a4c5-5585b6a2044c"], ["updated_at", "2014-06-29 12:14:07.104957"], ["user_id", "eb2c5b30-c098-452d-beca-f2933c52b74c"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 20ms (Views: 1.7ms | ActiveRecord: 2.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:14:07.110984"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:07.110984"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:07.113084"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:07.113084"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[35mUser Load (0.3ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:14:07.118600"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:14:07.118600"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:07.120308"], ["event", "view"], ["item_id", "429cbf6a-3572-42a2-a551-bfc7d37cec03"], ["updated_at", "2014-06-29 12:14:07.120308"], ["user_id", "39f94e37-dddf-48fd-81f3-96192f629ad7"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:07.124473"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:07.124473"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.1ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:07.126404"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:07.126404"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:14:07.130620"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:14:07.130620"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:07.132974"], ["event", "view"], ["item_id", "9034adab-5c7c-4ed2-b77f-4f0542425740"], ["updated_at", "2014-06-29 12:14:07.132974"], ["user_id", "49b73eb6-c1c5-4a5d-94a2-f9550aa9685a"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.3ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:14:07.138388"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:07.138388"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:07.140339"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:07.140339"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.2ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:07.146871"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:07.146871"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:07.149129"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:07.149129"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------
LayerApiTest: test_truth
------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.7ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.488182"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.488182"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.496996"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:14:41.496996"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 2.5ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.503477"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.503477"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.507781"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:14:41.507781"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.511766"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.511766"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 12ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:41.528881"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.528881"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"e7325c00-dac4-4b07-a145-7b93d58cbaa6", "user"=>{"identifier"=>nil}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "e7325c00-dac4-4b07-a145-7b93d58cbaa6"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != 'e7325c00-dac4-4b07-a145-7b93d58cbaa6') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 4ms (Views: 0.1ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:41.537110"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.537110"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"8b6747fc-8824-48f6-ae66-fbb474d61ff8", "user"=>{"identifier"=>"user@example.com"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1[0m  [["id", "8b6747fc-8824-48f6-ae66-fbb474d61ff8"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '8b6747fc-8824-48f6-ae66-fbb474d61ff8') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '8b6747fc-8824-48f6-ae66-fbb474d61ff8'  [["properties", nil], ["updated_at", "2014-06-29 12:14:41.540899"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.553911"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.553911"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.558798"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:14:41.558798"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 1.1ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.563367"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.563367"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.567065"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:14:41.567065"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.570534"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.570534"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"dd21af5e-864f-42af-a532-f094e5ddb526", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "dd21af5e-864f-42af-a532-f094e5ddb526"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != 'dd21af5e-864f-42af-a532-f094e5ddb526') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = 'dd21af5e-864f-42af-a532-f094e5ddb526'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 12:14:41.574436"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ApiControllerTest: test_with_an_api_key_you_have_access
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-------------------------------------------------------------------------
LayerApi::ApiControllerTest: test_without_an_api_key_you_dont_have_access
-------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:41.623044"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.623044"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:41.625359"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.625359"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 15ms (Views: 0.2ms | ActiveRecord: 1.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:41.647743"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.647743"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:41.649903"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.649903"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.5ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.657418"], ["event", "view"], ["item_id", "0b7323c8-f370-461c-96e6-f63fe127ed12"], ["updated_at", "2014-06-29 12:14:41.657418"], ["user_id", "078e3321-b34f-42ec-ad71-18ca7a601847"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 1.8ms | ActiveRecord: 1.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.664082"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.664082"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.666426"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.666426"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[35mUser Load (0.3ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.671839"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:14:41.671839"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:41.673642"], ["event", "view"], ["item_id", "e17230db-f1fa-453e-a6b3-0bc4129808d0"], ["updated_at", "2014-06-29 12:14:41.673642"], ["user_id", "6062d9a9-5301-408f-a1bc-127b8b4922ca"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:41.677988"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.677988"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:14:41.680128"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.680128"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.684470"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:14:41.684470"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.686873"], ["event", "view"], ["item_id", "4a5f49dd-03cd-4acf-881a-f88a4eb167b0"], ["updated_at", "2014-06-29 12:14:41.686873"], ["user_id", "60e80a1e-ee80-4fca-a721-cb4486f2f53f"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.694180"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.694180"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:14:41.696203"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:14:41.696203"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.2ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 1ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------
LayerApiTest: test_truth
------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.8ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:15:40.976086"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:40.976086"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:15:40.985681"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:15:40.985681"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 2.6ms | ActiveRecord: 0.7ms)
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:15:40.992823"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:40.992823"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:15:40.996723"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-29 12:15:40.996723"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:15:41.000300"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.000300"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"9c3275dd-1e80-42a0-80c5-c3b615d74deb", "item"=>{"name"=>"item 2"}}
  [1m[35mItem Load (0.3ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1  [["id", "9c3275dd-1e80-42a0-80c5-c3b615d74deb"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '9c3275dd-1e80-42a0-80c5-c3b615d74deb') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '9c3275dd-1e80-42a0-80c5-c3b615d74deb'[0m  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-29 12:15:41.005067"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.4ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.017902"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.017902"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.020264"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.020264"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 56ms (Views: 0.2ms | ActiveRecord: 1.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.084375"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.084375"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.086646"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.086646"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#index as JSON
  [1m[36mEvent Load (0.3ms)[0m  [1mSELECT "events".* FROM "events"[0m
Completed 200 OK in 1ms (Views: 0.4ms | ActiveRecord: 0.3ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
------------------------
LayerApiTest: test_truth
------------------------
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:15:41.096423"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.096423"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:15:41.098625"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.098625"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.5ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.106455"], ["event", "view"], ["item_id", "7e1a69e1-e0a6-4e31-9c8c-d1f69a05587b"], ["updated_at", "2014-06-29 12:15:41.106455"], ["user_id", "71aef975-06b3-4363-9120-d956172450ed"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 9ms (Views: 2.2ms | ActiveRecord: 1.1ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.112613"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.112613"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.114785"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.114785"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.1ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.119655"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-29 12:15:41.119655"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:15:41.121224"], ["event", "view"], ["item_id", "f7c39b28-7481-4079-8263-2693e6c3b4bc"], ["updated_at", "2014-06-29 12:15:41.121224"], ["user_id", "37d3cebe-02c6-410c-9a46-177a3e9a400e"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.3ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:15:41.125259"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.125259"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-29 12:15:41.127287"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.127287"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.131915"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-29 12:15:41.131915"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.134291"], ["event", "view"], ["item_id", "8d8e770a-c234-470d-9ab2-78ffbc5009e7"], ["updated_at", "2014-06-29 12:15:41.134291"], ["user_id", "fee357d2-4ce0-4759-aa52-a36893f6044a"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.4ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.140243"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.140243"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.144599"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:15:41.144599"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.147932"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.147932"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.151236"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-29 12:15:41.151236"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 2ms (Views: 0.3ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-29 12:15:41.154398"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.154398"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:15:41.160879"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.160879"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"6b7c5d31-e563-4d22-9f81-3012b11a461a", "user"=>{"identifier"=>nil}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "6b7c5d31-e563-4d22-9f81-3012b11a461a"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '6b7c5d31-e563-4d22-9f81-3012b11a461a') LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-29 12:15:41.168465"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-29 12:15:41.168465"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"76e0c900-740c-4a97-80dc-476d9941c406", "user"=>{"identifier"=>"user@example.com"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "76e0c900-740c-4a97-80dc-476d9941c406"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != '76e0c900-740c-4a97-80dc-476d9941c406') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = '76e0c900-740c-4a97-80dc-476d9941c406'[0m  [["properties", nil], ["updated_at", "2014-06-29 12:15:41.172173"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_create_a_event_with_user_and_item
---------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (1.0ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (2.9ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-30 14:29:43.360992"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.360992"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.5ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-30 14:29:43.375054"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.375054"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.6ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.395935"], ["event", "view"], ["item_id", "4c4103cc-86a6-4f47-8937-b4ce8e3de4c6"], ["updated_at", "2014-06-30 14:29:43.395935"], ["user_id", "0ac4f6c5-384a-4ec1-b8b1-7204a0b25fbf"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 25ms (Views: 6.1ms | ActiveRecord: 2.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_item_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.406579"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.406579"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.408764"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.408764"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"user@example.com", "item_identifier"=>"UNKNOWN_ITEM_ID", "event"=>"view"}}
  [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'user@example.com'  ORDER BY "users"."id" ASC LIMIT 1[0m
  [1m[35mItem Load (0.2ms)[0m  SELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID'  ORDER BY "items"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.1ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'UNKNOWN_ITEM_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.413813"], ["identifier", "UNKNOWN_ITEM_ID"], ["updated_at", "2014-06-30 14:29:43.413813"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-30 14:29:43.415463"], ["event", "view"], ["item_id", "666227b7-7a00-4684-80db-61ca1ce2e9a1"], ["updated_at", "2014-06-30 14:29:43.415463"], ["user_id", "e6f61979-f9cc-42cd-b38c-e2e7a9b54e1b"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.2ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
-----------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsCreated: test_the_user_is_unknown_so_it_will_be_created
-----------------------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-30 14:29:43.420283"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.420283"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-30 14:29:43.422451"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.422451"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"user_identifier"=>"UNKNOWN_USER_ID", "item_identifier"=>"sku123", "event"=>"view"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID'  ORDER BY "users"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'UNKNOWN_USER_ID' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.426828"], ["identifier", "UNKNOWN_USER_ID"], ["updated_at", "2014-06-30 14:29:43.426828"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."identifier" = 'sku123'  ORDER BY "items"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "events" ("created_at", "event", "item_id", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.429067"], ["event", "view"], ["item_id", "297176cd-9e82-4a53-a366-7a4f3b5402b3"], ["updated_at", "2014-06-30 14:29:43.429067"], ["user_id", "adedd351-cc94-47c1-9a68-83ccf2f79f93"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 6ms (Views: 0.8ms | ActiveRecord: 1.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_identifier
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.437396"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.437396"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.441997"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-30 14:29:43.441997"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.6ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.445826"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.445826"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>"test@example.com", "properties"=>{"favorite_color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'test@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.449767"], ["identifier", "test@example.com"], ["properties", "\"favorite_color\"=>\"red\""], ["updated_at", "2014-06-30 14:29:43.449767"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_create_a_user_without_identifier
--------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.453571"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.453571"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::UsersController#create as JSON
  Parameters: {"user"=>{"identifier"=>nil}}
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" IS NULL LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 5ms (Views: 0.1ms | ActiveRecord: 0.4ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------------------------
LayerApi::UsersControllerTest: test_update_a_user_without_identifier
--------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-30 14:29:43.463120"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.463120"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"31f94bac-c696-43d8-89bd-0192fd0a7f58", "user"=>{"identifier"=>nil}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "31f94bac-c696-43d8-89bd-0192fd0a7f58"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" IS NULL AND "users"."id" != '31f94bac-c696-43d8-89bd-0192fd0a7f58') LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 400 Bad Request in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
--------------------------------------------------
LayerApi::UsersControllerTest: test_update_an_user
--------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-30 14:29:43.471343"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.471343"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::UsersController#update as JSON
  Parameters: {"id"=>"d22fd8b6-bb7b-44a6-816b-6abb23304896", "user"=>{"identifier"=>"user@example.com"}}
  [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  WHERE "users"."id" = $1 LIMIT 1  [["id", "d22fd8b6-bb7b-44a6-816b-6abb23304896"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE ("users"."identifier" = 'user@example.com' AND "users"."id" != 'd22fd8b6-bb7b-44a6-816b-6abb23304896') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "properties" = $1, "updated_at" = $2 WHERE "users"."id" = 'd22fd8b6-bb7b-44a6-816b-6abb23304896'[0m  [["properties", nil], ["updated_at", "2014-06-30 14:29:43.475781"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_name
-----------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.481630"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.481630"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.486567"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-30 14:29:43.486567"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
-----------------------------------------------------------------
LayerApi::ItemsControllerTest: test_create_a_item_with_properties
-----------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.491143"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.491143"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#create as JSON
  Parameters: {"item"=>{"identifier"=>"sku_123", "name"=>"item 1", "properties"=>{"color"=>"red"}}}
Unpermitted parameters: properties
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku_123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.495657"], ["identifier", "sku_123"], ["name", "item 1"], ["properties", "\"color\"=>\"red\""], ["updated_at", "2014-06-30 14:29:43.495657"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.5ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
--------------------------------------------------
LayerApi::ItemsControllerTest: test_update_an_item
--------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.499464"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.499464"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::ItemsController#update as JSON
  Parameters: {"id"=>"3ae63de0-5b20-456e-a3b7-7e51cc78b1d4", "item"=>{"name"=>"item 2"}}
  [1m[36mItem Load (0.2ms)[0m  [1mSELECT  "items".* FROM "items"  WHERE "items"."id" = $1 LIMIT 1[0m  [["id", "3ae63de0-5b20-456e-a3b7-7e51cc78b1d4"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE ("items"."identifier" = 'sku123' AND "items"."id" != '3ae63de0-5b20-456e-a3b7-7e51cc78b1d4') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "items" SET "name" = $1, "properties" = $2, "updated_at" = $3 WHERE "items"."id" = '3ae63de0-5b20-456e-a3b7-7e51cc78b1d4'  [["name", "item 2"], ["properties", nil], ["updated_at", "2014-06-30 14:29:43.503949"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
---------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventIndexTest: test_index_returns_all_the_events
---------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"  [["created_at", "2014-06-30 14:29:43.509330"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.509330"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mItem Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["created_at", "2014-06-30 14:29:43.511396"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.511396"]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by LayerApi::EventsController#index as JSON
  [1m[35mEvent Load (0.3ms)[0m  SELECT "events".* FROM "events"
Completed 200 OK in 1ms (Views: 0.4ms | ActiveRecord: 0.3ms)
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------
LayerApiTest: test_truth
------------------------
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
------------------------------------------------------------------------------------------------------------------
LayerApi::EventsControllerTest::EventCreationTest::EventIsNotCreated: test_create_a_event_without_attributes_fails
------------------------------------------------------------------------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users"  WHERE "users"."identifier" = 'user@example.com' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "users" ("created_at", "identifier", "properties", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.520074"], ["identifier", "user@example.com"], ["properties", "\"favorite_color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.520074"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mItem Exists (0.2ms)[0m  SELECT  1 AS one FROM "items"  WHERE "items"."identifier" = 'sku123' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "items" ("created_at", "identifier", "name", "properties", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["created_at", "2014-06-30 14:29:43.522456"], ["identifier", "sku123"], ["name", "item name"], ["properties", "\"color\"=>\"blue\""], ["updated_at", "2014-06-30 14:29:43.522456"]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by LayerApi::EventsController#create as JSON
  Parameters: {"event"=>{"x"=>:y}}
Unpermitted parameters: x
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
Completed 400 Bad Request in 3ms (Views: 0.2ms | ActiveRecord: 0.2ms)
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
